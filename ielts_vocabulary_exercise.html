<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IELTS Vocabulary Exercise - Addition, Equation & Conclusion (with XP and Progress)</title>
  <style>
    :root {
      --bg: #f6f5f2;
      --card: #d6d1c4;
      --accent-blue: #b8c6db;
      --accent-peach: #f2e9e1;
      --primary: #8ca6db;
      --secondary: #e8a87c;
      --header: #6d6875;
      --sand: #e1d7c6;
      --font-main: 'Quicksand', 'Nunito', Arial, sans-serif;
    }
    body {
      font-family: var(--font-main);
      background: var(--bg);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: #444;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: var(--card);
      border-radius: 18px;
      padding: 30px;
      box-shadow: 0 2px 20px rgba(109, 104, 117, 0.09);
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
      color: var(--header);
    }
    .header h1 {
      font-family: 'Quicksand', cursive, sans-serif;
      font-size: 2.2rem;
      margin-bottom: 0.3rem;
      letter-spacing: 0.02em;
    }
    .header p {
      font-size: 1.15rem;
      color: var(--header);
      margin: 0;
      font-weight: 600;
    }
    .hints {
      background: var(--sand);
      border-radius: 15px;
      padding: 15px 20px;
      margin-bottom: 25px;
      font-size: 1rem;
      color: var(--header);
      line-height: 1.5;
    }
    .score-display, #xp-display {
      text-align: center;
      font-size: 1.5rem;
      color: var(--primary);
      margin: 8px 0;
      font-weight: 700;
    }
    .progress-bar-container {
      height: 24px;
      background: var(--accent-peach);
      border-radius: 24px;
      margin: 15px 0;
      box-shadow: inset 0 2px 8px rgba(232,168,124,0.15);
      position: relative;
      overflow: hidden;
    }
    .progress-bar-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 24px;
      width: 0%;
      transition: width 0.3s ease;
    }
    .progress-bar-text {
      position: absolute;
      width: 100%;
      text-align: center;
      color: white;
      font-weight: 700;
      line-height: 24px;
      font-family: var(--font-main);
      font-size: 1rem;
      user-select: none;
      pointer-events: none;
    }
    .word-bank {
      background: var(--accent-peach);
      border: 2px dashed var(--primary);
      border-radius: 18px;
      padding: 20px;
      margin-bottom: 25px;
      min-height: 100px;
      color: var(--header);
    }
    .word-bank h3 {
      margin: 0 0 15px;
      text-align: center;
      font-weight: 700;
      font-size: 1.25rem;
    }
    .words-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .word-item {
      background: var(--primary);
      color: white;
      padding: 8px 15px;
      border-radius: 24px;
      cursor: grab;
      user-select: none;
      transition: all 0.3s ease;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(140, 166, 219, 0.08);
    }
    .word-item:hover {
      background: var(--secondary);
      box-shadow: 0 6px 15px rgba(232, 168, 124, 0.18);
      transform: translateY(-2px);
    }
    .word-item.dragging {
      opacity: 0.5;
      transform: rotate(5deg);
    }
    .word-item.correct {
      background: #51cf66;
      border: 2px solid #40c057;
    }
    .word-item.incorrect {
      background: #ff6b6b;
      border: 2px solid #fa5252;
    }
    .categories {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 25px;
    }
    .category {
      background: var(--sand);
      border: 2px solid var(--card);
      border-radius: 18px;
      min-height: 200px;
      padding: 20px;
      transition: all 0.3s ease;
      color: var(--header);
    }
    .category.drag-over {
      border-color: var(--primary);
      background: #f5f8fb;
      transform: scale(1.02);
    }
    .category h3 {
      text-align: center;
      margin: 0 0 15px;
      padding: 10px;
      border-radius: 12px;
      background: var(--primary);
      color: white;
      font-weight: 700;
      font-size: 1.2rem;
    }
    .category[data-category='addition'] h3 {
      background: var(--primary);
    }
    .category[data-category='equation'] h3 {
      background: #7ea9dd;
    }
    .category[data-category='conclusion'] h3 {
      background: #e8a87c;
    }
    .controls {
      text-align: center;
      margin-top: 25px;
    }
    .btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 14px 30px;
      border-radius: 24px;
      cursor: pointer;
      font-family: var(--font-main);
      font-size: 1.15rem;
      font-weight: 700;
      margin: 0 12px;
      box-shadow: 0 4px 12px rgba(140, 166, 219, 0.2);
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .btn:hover {
      background: var(--secondary);
      color: var(--header);
      box-shadow: 0 6px 15px rgba(232, 168, 124, 0.3);
      transform: translateY(-3px);
    }
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üéØ IELTS Vocabulary Exercise</h1>
    <p>Day 1: Addition, Equation & Conclusion</p>
    <div class="score-display" id="score-display">Score: 0 / 24</div>
    <div id="xp-display">Total XP: 0</div>
  </div>

  <div class="hints">
    <strong>Hints:</strong> Drag the words from the Word Bank into the correct categories: Addition, Equation, Conclusion.
  </div>

  <div class="progress-bar-container" aria-label="Progress of words moved from word bank">
    <div class="progress-bar-fill" id="progress-fill" style="width: 0%;"></div>
    <div class="progress-bar-text" id="progress-text">Words Left in Word Bank: 24</div>
  </div>

  <div class="word-bank">
    <h3>üìù Word Bank - Drag these words to the correct categories</h3>
    <div class="words-container" id="word-bank"></div>
  </div>

  <div class="categories">
    <div class="category" data-category="addition">
      <h3>Addition</h3>
      <div class="words-container"></div>
    </div>
    <div class="category" data-category="equation">
      <h3>Equation</h3>
      <div class="words-container"></div>
    </div>
    <div class="category" data-category="conclusion">
      <h3>Conclusion</h3>
      <div class="words-container"></div>
    </div>
  </div>

  <div class="controls">
    <button class="btn" id="check-answers-btn">Check Answers</button>
    <button class="btn" id="reset-btn">Reset Exercise</button>
  </div>
</div>

<script>
  let score = 0;
  const maxScore = 24;

  const correctAnswers = {
    addition: ['as well as', 'in addition', 'and', 'too', 'moreover', 'besides', 'also', "what's more", 'furthermore', 'along with'],
    equation: ['likewise', 'similarly', 'in the same way', 'equally', 'correspondingly'],
    conclusion: ['thus', 'briefly', 'to sum up', 'therefore', 'to summarise', 'in conclusion', 'in brief', 'we can conclude that', 'to conclude']
  };

  const vocabularyWords = [
    'as well as', 'thus', 'briefly', 'to sum up', 'therefore', 'in addition',
    'likewise', 'to summarise', 'and', 'too', 'similarly', 'moreover',
    'in conclusion', 'besides', 'also', 'in the same way', 'in brief',
    "what's more", 'furthermore', 'we can conclude that', 'equally',
    'along with', 'to conclude', 'correspondingly'
  ];

  function initializeExercise() {
    populateWordBank();
    setupDragAndDrop();
    loadPreviousProgress();
    updateXPDisplay(getTotalXP());
    updateScoreDisplay();
    updateProgressBar();
  }

  function populateWordBank() {
    const wordBank = document.getElementById('word-bank');
    wordBank.innerHTML = '';
    vocabularyWords.forEach(word => {
      const wordElement = createWordElement(word);
      wordBank.appendChild(wordElement);
    });
  }

  function createWordElement(word) {
    const wordDiv = document.createElement('div');
    wordDiv.className = 'word-item';
    wordDiv.textContent = word;
    wordDiv.draggable = true;
    wordDiv.addEventListener('dragstart', handleDragStart);
    wordDiv.addEventListener('dragend', handleDragEnd);
    return wordDiv;
  }

  function setupDragAndDrop() {
    const categories = document.querySelectorAll('.category');
    categories.forEach(category => {
      category.addEventListener('dragover', handleDragOver);
      category.addEventListener('drop', handleDrop);
      category.addEventListener('dragenter', handleDragEnter);
      category.addEventListener('dragleave', handleDragLeave);
    });
    const wordBank = document.getElementById('word-bank');
    wordBank.addEventListener('dragover', handleDragOver);
    wordBank.addEventListener('drop', handleDrop);
  }

  let draggedElement = null;

  function handleDragStart(e) {
    draggedElement = e.target;
    e.target.classList.add('dragging');
  }

  function handleDragEnd(e) {
    e.target.classList.remove('dragging');
    draggedElement = null;
    updateProgressBar();     // Update progress on drag end
  }

  function handleDragOver(e) {
    e.preventDefault();
  }

  function handleDragEnter(e) {
    if (e.target.classList.contains('category')) {
      e.target.classList.add('drag-over');
    }
  }

  function handleDragLeave(e) {
    if (e.target.classList.contains('category')) {
      e.target.classList.remove('drag-over');
    }
  }

  function handleDrop(e) {
    e.preventDefault();
    if (!draggedElement) return;

    let dropTarget = e.target;

    if (dropTarget.classList.contains('category')) {
      dropTarget = dropTarget.querySelector('.words-container');
    } else if (dropTarget.id === 'word-bank') {
      dropTarget = dropTarget;
    } else if (dropTarget.classList.contains('words-container')) {
      dropTarget = dropTarget;
    } else {
      return;
    }

    if (draggedElement.parentNode) {
      draggedElement.parentNode.removeChild(draggedElement);
    }

    dropTarget.appendChild(draggedElement);

    document.querySelectorAll('.category').forEach(cat => cat.classList.remove('drag-over'));

    draggedElement.classList.remove('correct', 'incorrect');

    updateProgressBar();  // Update progress when dropping as well
  }

  function updateProgressBar() {
    const wordBank = document.getElementById('word-bank');
    const progressText = document.getElementById('progress-text');
    const progressFill = document.getElementById('progress-fill');
    const totalWords = vocabularyWords.length;
    const wordsLeft = wordBank.children.length;
    const percent = ((totalWords - wordsLeft) / totalWords) * 100;

    progressFill.style.width = `${percent}%`;
    progressText.textContent = `Words Left in Word Bank: ${wordsLeft}`;
  }

  function calculateXP(score, maxScore) {
    const baseXP = 100;
    const alpha = 1.5;
    return Math.round(baseXP * Math.pow(score / maxScore, alpha));
  }

  function checkAnswers() {
    score = 0;

    document.querySelectorAll('.word-item').forEach(word => {
      word.classList.remove('correct', 'incorrect');
    });

    Object.keys(correctAnswers).forEach(category => {
      const categoryElement = document.querySelector(`.category[data-category="${category}"] .words-container`);
      const wordsInCategory = Array.from(categoryElement.children);

      wordsInCategory.forEach(wordElement => {
        const wordText = wordElement.textContent.trim().toLowerCase();
        const correctWords = correctAnswers[category].map(w => w.toLowerCase());
        if (correctWords.includes(wordText)) {
          score++;
          wordElement.classList.add('correct');
        } else {
          wordElement.classList.add('incorrect');
        }
      });
    });

    updateScoreAndProgress();
  }

  function updateScoreDisplay() {
    const scoreDisplay = document.getElementById('score-display');
    scoreDisplay.textContent = `Score: ${score} / ${maxScore}`;
  }

  function getTotalXP() {
    try {
      const saved = localStorage.getItem('ielts_total_xp');
      return saved ? parseInt(saved, 10) : 0;
    } catch {
      return 0;
    }
  }

  function updateXP(newXP) {
    const savedXP = getTotalXP();
    const totalXP = savedXP + newXP;
    localStorage.setItem('ielts_total_xp', totalXP);
    updateXPDisplay(totalXP);
    sendProgressToParentWithXP(totalXP);
  }

  function updateXPDisplay(totalXP) {
    const xpDisplay = document.getElementById('xp-display');
    if (xpDisplay) {
      xpDisplay.textContent = `Total XP: ${totalXP}`;
    }
  }

  function sendProgressToParentWithXP(totalXP) {
    const progress = {
      ielts_progress: {
        id: 'vocab',
        completed: score === maxScore,
        bestScore: score,
        totalXP: totalXP
      }
    };

    if (window.parent && window.parent !== window) {
      window.parent.postMessage(progress, '*');
      console.log('Progress sent to parent with XP:', progress);
    }
  }

  function saveProgressLocally() {
    try {
      const previousBest = getBestScore();
      const newBest = Math.max(score, previousBest);

      const progressData = {
        completed: score === maxScore,
        bestScore: newBest,
        lastAttempt: new Date().toISOString()
      };

      localStorage.setItem('ielts_progress_vocab', JSON.stringify(progressData));
      console.log('Progress saved locally:', progressData);
    } catch (error) {
      console.error('Failed to save progress:', error);
    }
  }

  function getBestScore() {
    try {
      const saved = localStorage.getItem('ielts_progress_vocab');
      return saved ? JSON.parse(saved).bestScore || 0 : 0;
    } catch {
      return 0;
    }
  }

  function updateScoreAndProgress() {
    updateScoreDisplay();
    const xpGained = calculateXP(score, maxScore);
    updateXP(xpGained);
    saveProgressLocally();
  }

  function resetExercise() {
    score = 0;
    updateScoreDisplay();
    updateXPDisplay(getTotalXP());

    document.querySelectorAll('.word-item').forEach(word => {
      word.classList.remove('correct', 'incorrect');
    });
    const wordBank = document.getElementById('word-bank');
    document.querySelectorAll('.word-item').forEach(word => {
      wordBank.appendChild(word);
    });

    updateProgressBar();
  }

  document.addEventListener('DOMContentLoaded', () => {
    initializeExercise();
    document.getElementById('check-answers-btn').addEventListener('click', checkAnswers);
    document.getElementById('reset-btn').addEventListener('click', resetExercise);
  });
</script>
</body>
</html>
