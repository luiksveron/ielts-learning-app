<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IELTS Writing Paraphrasing Daily Practice</title>
<style>
  :root {
    --bg: #f6f5f2;
    --card: #d6d1c4;
    --accent-blue: #b8c6db;
    --accent-peach: #f2e9e1;
    --primary: #8ca6db;
    --secondary: #e8a87c;
    --header: #6d6875;
    --sand: #e1d7c6;
    --font-main: 'Quicksand', 'Nunito', Arial, sans-serif;
  }
  body {
    font-family: var(--font-main);
    background: var(--bg);
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    color: #444;
    display: flex;
    justify-content: center;
  }
  .container {
    background: var(--card);
    max-width: 700px;
    width: 100%;
    border-radius: 18px;
    box-shadow: 0 2px 20px rgba(109, 104, 117, 0.09);
    padding: 30px;
  }
  h1 {
    text-align: center;
    color: var(--header);
    margin-bottom: 15px;
    font-size: 2rem;
  }
  .question {
    font-size: 1.2rem;
    color: var(--header);
    background: var(--sand);
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 20px;
  }
  textarea {
    width: 100%;
    min-height: 140px;
    border-radius: 12px;
    border: 2px solid var(--primary);
    padding: 12px;
    font-size: 1.1rem;
    resize: vertical;
    font-family: var(--font-main);
    margin-bottom: 20px;
    color: #444;
  }
  button {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 14px 25px;
    border-radius: 24px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    width: 100%;
    box-shadow: 0 4px 12px rgba(140,166,219,0.18);
    transition: background-color 0.3s ease, transform 0.2s ease;
  }
  button:hover {
    background-color: var(--secondary);
    color: var(--header);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(232,168,124,0.3);
  }
  .output {
    background: var(--sand);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
    color: var(--header);
    font-weight: 600;
  }
  .band-score {
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--primary);
    margin-top: 15px;
    text-align: center;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>Writing Task 2: Paraphrasing Practice</h1>
    <div class="question" id="original-question">
      Some people think that university education should be free for all students. To what extent do you agree or disagree?
    </div>
    <textarea id="user-input" placeholder="Type your paraphrase here..."></textarea>
    <button id="analyze-btn">Analyze Paraphrase</button>

    <div class="output" id="analysis-output" style="display:none;">
      <div><strong>Your Analysis:</strong></div>
      <div id="analysis-text"></div>
      <div class="band-score" id="band-score"></div>
      <div><strong>Band 9 Model Paraphrase:</strong></div>
      <div id="model-paraphrase" style="margin-top:8px; font-style: italic; color: var(--header);"></div>
      <div style="margin-top:15px; font-size:0.9rem; color: var(--header); font-weight: 400;">
        Advice for Band 9: Use precise vocabulary, maintain meaning without repetition, vary complex sentence structures.
      </div>
    </div>
  </div>

  <script>
    const analyzeBtn = document.getElementById('analyze-btn');
    const userInput = document.getElementById('user-input');
    const analysisOutput = document.getElementById('analysis-output');
    const analysisText = document.getElementById('analysis-text');
    const bandScoreElem = document.getElementById('band-score');
    const modelParaphrase = document.getElementById('model-paraphrase');
    const originalText = document.getElementById('original-question').textContent;

    function getPreviousBestScore() {
      try {
        const saved = localStorage.getItem('ielts_progress_paraphrase');
        return saved ? JSON.parse(saved).bestScore || 0 : 0;
      } catch {
        return 0;
      }
    }

    function saveProgressLocally(score) {
      try {
        const previousBest = getPreviousBestScore();
        const newBest = Math.max(score, previousBest);
        const progressData = {
          completed: score >= 7,
          bestScore: newBest,
          lastAttempt: new Date().toISOString()
        };
        localStorage.setItem('ielts_progress_paraphrase', JSON.stringify(progressData));
        console.log('Paraphrase progress saved locally:', progressData);
      } catch (error) {
        console.error('Failed to save paraphrase progress:', error);
      }
    }

    function sendProgressToParent(score) {
      const progress = {
        ielts_progress: {
          id: 'paraphrase',
          completed: score >= 7.0,
          bestScore: score,
          totalXP: Math.round(score * 10) // Example XP scaling (modify as needed)
        }
      };
      if (window.parent && window.parent !== window) {
        window.parent.postMessage(progress, "*");
        console.log('Paraphrase progress sent to parent:', progress);
      }
    }

    function analyzeParaphrase() {
      const userText = userInput.value.trim();
      if (!userText) {
        alert('Please enter your paraphrase first.');
        return;
      }

      // Dummy text complexity & vocabulary analysis for demonstration
      const lengthScore = Math.min(userText.split(' ').length / originalText.split(' ').length * 5, 5);
      const vocabScore = userText.match(/\b(belief|higher|education|provided|learner|access|charge|critically|statement|individual)\b/gi)?.length || 0;
      // Simple combined score out of 9
      let bandScore = Math.min((lengthScore + vocabScore) / 2 + 4, 9);

      analysisOutput.style.display = 'block';
      analysisText.textContent = `Grammar complexity rating: ${(bandScore - 0.5).toFixed(1)} / 9  Vocabulary sophistication rating: ${(bandScore).toFixed(1)} / 9`;
      bandScoreElem.textContent = `Estimated Band Score: ${bandScore.toFixed(1)}`;
      modelParaphrase.textContent = "It is contended by some that access to university education should be offered free of charge to every individual. This essay will critically examine the extent of my agreement with this statement.";

      saveProgressLocally(bandScore);
      sendProgressToParent(bandScore);
    }

    analyzeBtn.addEventListener('click', analyzeParaphrase);

    document.addEventListener('DOMContentLoaded', () => {
      // Optionally load saved best score or initialize UI
    });
  </script>
</body>
</html>
